<%- include('partials/header.html') %>

    <div class="grid md:grid-cols-3 gap-8">
        <!-- Session Info & QR -->
        <div class="md:col-span-1 space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-md border border-emerald-100">
                <h2 class="text-xl font-bold text-emerald-800 mb-4">
                    <%= session.title %>
                </h2>
                <div class="space-y-2 text-gray-600">
                    <p><strong>ุงูุดูุฎ:</strong>
                        <%= session.sheikh_name %>
                    </p>
                    <p><strong>ุงูุชุงุฑูุฎ:</strong>
                        <%= session.date %>
                    </p>
                    <p><strong>ุงูููุช:</strong>
                        <%= session.start_time %> - <%= session.end_time %>
                    </p>
                    <% if(session.description) { %>
                        <p class="text-sm italic mt-2">
                            <%= session.description %>
                        </p>
                        <% } %>
                </div>
            </div>

            <% if (isActive) { %>
                <div class="bg-white p-6 rounded-xl shadow-md border-amber-200 border-2 text-center">
                    <h3 class="text-lg font-bold text-amber-800 mb-4">ุฑูุฒ ุชุณุฌูู ุงูุญุถูุฑ</h3>
                    <div id="qrcode" class="flex justify-center mb-4"></div>
                    <!-- Client-side QR generation for simplicity in view, or we can use the server one passed in. 
                 Let's use a client script to generate it on the fly or just an img tag to a route? 
                 Actually, simple client JS is fine or better, use the API to get it?
                 Wait, I can just use a library here or an image text.
                 Let's use an img tag pointing to an API that returns the QR, or simpler: 
                 Just use the frontend qrcode.js IF i had it. 
                 But I have 'qrcode' package on backend. I should pass the Data URL from backend.
                 I'll update the route to pass 'qrCodeDataUrl'. 
            -->
                    <img src="<%= qrCodeDataUrl %>" alt="Session QR Code" class="mx-auto w-48 h-48">
                    <p class="text-sm text-gray-500 mt-2">ุงูุณุญ ุงูุฑูุฒ ูุชุณุฌูู ุงูุญุถูุฑ</p>
                    <a href="/register/<%= session.id %>" class="block mt-2 text-emerald-600 underline text-sm"
                        target="_blank">ุฑุงุจุท ูุจุงุดุฑ</a>
                </div>
                <% } else { %>
                    <div class="bg-gray-100 p-6 rounded-xl text-center text-gray-500 border border-gray-200">
                        <p>โ๏ธ ุงูุชุณุฌูู ูุบูู ุญุงููุงู (ุฎุงุฑุฌ ููุช ุงููุฌูุณ)</p>
                    </div>
                    <% } %>

                        <div class="bg-white p-6 rounded-xl shadow-md border border-emerald-100">
                            <h3 class="text-lg font-bold text-emerald-800 mb-4">ุฅุตุฏุงุฑ ุงูุฅุฌุงุฒุงุช</h3>
                            <form action="/api/certificates/generate" method="POST">
                                <input type="hidden" name="session_id" value="<%= session.id %>">
                                <button type="submit"
                                    class="w-full bg-amber-600 hover:bg-amber-700 text-white py-2 rounded-lg transition shadow">
                                    ๐จ๏ธ ุฅุตุฏุงุฑ ุงูุฅุฌุงุฒุงุช (PDF)
                                </button>
                            </form>
                            <p class="text-xs text-gray-500 mt-2 text-center">ุณูุชู ุฅูุดุงุก ูููุงุช PDF ููุญุถูุฑ.</p>
                        </div>
        </div>

        <!-- Attendees List -->
        <div class="md:col-span-2">
            <div class="bg-white p-6 rounded-xl shadow-md border border-emerald-100">
                <h3 class="text-xl font-bold text-emerald-800 mb-4">ูุงุฆูุฉ ุงูุญุถูุฑ (<%= attendees.length %>)</h3>

                <% if (attendees.length===0) { %>
                    <p class="text-gray-500">ูุง ููุฌุฏ ุญุถูุฑ ูุณุฌู ุญุชู ุงูุขู.</p>
                    <% } else { %>
                        <div class="overflow-x-auto">
                            <table class="w-full text-right">
                                <thead class="bg-emerald-50 text-emerald-800">
                                    <tr>
                                        <th class="p-3">ุงูุงุณู</th>
                                        <th class="p-3">ููุช ุงูุชุณุฌูู</th>
                                        <th class="p-3">ุงูุญุงูุฉ</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-emerald-50">
                                    <% attendees.forEach(attendee=> { %>
                                        <tr>
                                            <td class="p-3 font-semibold">
                                                <%= attendee.name %>
                                            </td>
                                            <td class="p-3 text-sm text-gray-600">
                                                <%= new Date(attendee.created_at).toLocaleTimeString('ar-EG') %>
                                            </td>
                                            <td class="p-3">
                                                <span
                                                    class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">ูุณุฌู</span>
                                            </td>
                                        </tr>
                                        <% }) %>
                                </tbody>
                            </table>
                        </div>
                        <% } %>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>